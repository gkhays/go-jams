FROM registry.access.redhat.com/ubi9/ubi-minimal:9.3 AS builder

RUN microdnf install -y golang openssl-devel

WORKDIR /build

COPY ../bin/server-0.1.0-dev-linux-amd64 /app/server

FROM registry.access.redhat.com/ubi9/ubi-minimal:9.3

# Enable FIPS mode
RUN fips-mode-setup --enable && \
    microdnf install -y crypto-policies-scripts && \
    update-crypto-policies --set FIPS

COPY --from=builder /build/server /app/server
EXPOSE 8080
CMD ["/app/server"]